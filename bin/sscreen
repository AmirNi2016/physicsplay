#!/usr/bin/perl

use strict ;
use warnings ;
use Getopt::Long ;

my $newscreen = 0 ;

GetOptions
(
   'new!'       => \$newscreen,
#   'help!'      => \$showUsage,
) ;

my $hostname = `hostname` ;
chomp $hostname ;

if ( -e "$ENV{HOME}/.screenhost" && $hostname =~ /^scinet/ )
{
   my $alias = `cat $ENV{HOME}/.screenhost` ; chomp $alias ;

   system( "ssh -t $alias 'module load extras ; screen -dr'" ) ;
}
elsif ( $newscreen )
{
#   # from a name like gpc-f101n084-ib0 extract the node number that matches the gpc0N alias:
#   my $hostnumber = $hostname ;
#   $hostnumber =~ s/^gpc-f10// or die "hostname unexpected: '$hostname'" ;
#   $hostnumber =~ s/(.).*/$1/ or die "hostname unexpected: '$hostname'" ;
#
#   my $alias = "gpc0$hostnumber" ;
#
#   # check this against the DNS registry:
#   my $aname = `nslookup $alias | grep ^Name:` ; chomp $aname ;
#   $aname =~ s/^Name:\s+// or die "unexpected nslookup data: '$aname'" ;
#   $aname =~ s/\..*// or die "expected full hostname '$aname'" ;
#   die "$aname ne $hostname" if ( $aname ne $hostname ) ;

   system("cd ; echo $hostname > .screenhost ; module load extras ; screen -q" ) ;
}
else
{
   system( "gpc -t 'sscreen -new'" ) ;
}
