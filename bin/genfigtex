#!/usr/bin/perl

my %all = map {$_ => 1} @ARGV ;

#my $refTextPre = "figure (\\ref" ;
#my $refTextPost = ')' ;
my $refTextPre = "\\cref" ;
my $refTextPost = '' ;

foreach (sort keys %all)
{
   my $path = $_ ;

   die "Expect 'Fig' in the filename '$path'\n" unless ( $path =~ /(.*)Fig(.*)\.(.*)/ ) ;

   my ($basename, $figNum, $extension) = ($1, $2, $3) ;
   my $picturepath = "${basename}Fig$figNum" ;

   if ( $extension eq 'svg' )
   {
      next ;
   }
   elsif ( $extension eq 'pdf' )
   {
      next ;
   }
   elsif ( $extension =~ /mp4|swf|flv/ )
   {
my $fmov = "${refTextPre}{fig:$basename:$picturepath}$refTextPost.
\\movieFigure{$picturepath.$extension}{$figNum: FIXME: CAPTION}{fig:$basename:$picturepath}{width=320pt,height=240pt}
" ;

      print $fmov ;
   }
# doesn't work.  Run epstopdf instead to explicitly convert
#   elsif ( $extension eq 'eps' )
#   {
#my $f = "${refTextPre}{fig:$basename:$picturepath}$refTextPost.
#\\imageFigure{$picturepath.$extension}{$figNum: FIXME: CAPTION}{fig:$basename:$picturepath}{0.2}
#" ;
#
#      print $f ;
#   }
   elsif ( $extension eq 'png' )
   {
      next if ( exists $all{"$picturepath.pdf_tex"} ) ;

#\\begin{figure}[htp]
#   \\centering
#   \\includegraphics[totalheight=0.2\\textheight]
#   \\label{fig:$basename:$picturepath}
#\\end{figure}
my $f = "${refTextPre}{fig:$basename:$picturepath}$refTextPost.
\\imageFigure{$picturepath}{$figNum: FIXME: CAPTION}{fig:$basename:$picturepath}{0.2}
" ;

      print $f ;
   }
   elsif ( $extension eq 'pdf_tex' )
   {
#\\begin{figure}[htp]
#   \\centering
#   \\def\\svgwidth{0.3\\columnwidth}
#   \\input{$picturepath.pdf_tex}
#   \\caption{FIXME}\\label{fig:$basename:$picturepath}
#\\end{figure}
my $fpdf = "${refTextPre}{fig:$basename:$picturepath}$refTextPost.
\\pdfTexFigure{$picturepath.pdf_tex}{$figNum: FIXME: CAPTION}{fig:$basename:$picturepath}{0.3}
" ;

      print $fpdf ;
   }
#   else
#   {
#      warn "%UNKNOWN EXTENSION: skipping: $path\n" ;   
#   }
}
