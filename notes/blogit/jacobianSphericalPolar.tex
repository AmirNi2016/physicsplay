\input{../peeter_prologue.tex}

\chapter{Jacobians and spherical polar gradient.}
\label{chap:jacobianSphericalPolar}
%\useCCL
\blogpage{http://sites.google.com/site/peeterjoot/math2009/jacobianSphericalPolar.pdf}
\date{Dec 6, 2009}
\revisionInfo{jacobianSphericalPolar.tex}

\beginArtWithToc
%\beginArtNoToc

\section{Motivation}

The dumbest and most obvious way to do a chain of variables for the gradient is to utilize a chain rule expansion producing the Jacobian matrix to transform the coordinates.  Here we do this to calculate the spherical polar representation of the gradient.

There are smarter and easier ways to do this, but there is some suprising simple structure to the resulting Jacobians that seems worth noting.

\section{Spherical polar gradient coordinates in terms of cartesian.}

We wish to do a change of variables for each of the differential operators of the gradient.  This is essentially just application of the chain rule, as in

\begin{align}\label{eqn:jacobianSphericalPolar:1}
\PD{r}{} 
= 
\PD{r}{x} \PD{x}{}
+\PD{r}{y} \PD{y}{}
+\PD{r}{z} \PD{z}{}.
\end{align}

Collecting all such derivatives we have in column vector form 
\begin{align}\label{eqn:jacobianSphericalPolar:2}
\begin{bmatrix}
\partial_r \\
\partial_\theta \\
\partial_\phi
\end{bmatrix}
= 
\begin{bmatrix}
\PD{r}{x} &\PD{r}{y} &\PD{r}{z}  \\
\PD{\theta}{x} &\PD{\theta}{y} &\PD{\theta}{z}  \\
\PD{\phi}{x} &\PD{\phi}{y} &\PD{\phi}{z} 
\end{bmatrix}
\begin{bmatrix}
\partial_x \\
\partial_y \\
\partial_z
\end{bmatrix}.
\end{align}

This becomes a bit more tractible with the Jacobian notation

\begin{align}\label{eqn:jacobianSphericalPolar:3}
\frac{\partial (x,y,z)}{\partial (r,\theta,\phi)}
=
\begin{bmatrix}
\PD{r}{x} &\PD{r}{y} &\PD{r}{z}  \\
\PD{\theta}{x} &\PD{\theta}{y} &\PD{\theta}{z}  \\
\PD{\phi}{x} &\PD{\phi}{y} &\PD{\phi}{z}
\end{bmatrix}.
\end{align}

The change of variables for the operator triplet is then just
\begin{align}\label{eqn:jacobianSphericalPolar:4}
\begin{bmatrix}
\partial_r \\
\partial_\theta \\
\partial_\phi
\end{bmatrix}
= 
\frac{\partial (x,y,z)}{\partial (r,\theta,\phi)}
\begin{bmatrix}
\partial_x \\
\partial_y \\
\partial_z
\end{bmatrix}.
\end{align}

This Jacobian matrix is also not even too hard to calculate.  With $\Bx = r \rcap$, we have $x_k = r \rcap \cdot \Be_k$, and

\begin{subequations}
\begin{align}\label{eqn:jacobianSphericalPolar:5}
\PD{r}{x_k} &= \rcap \cdot \Be_k \\
\PD{\theta}{x_k} &= r \PD{\theta}{\rcap} \cdot \Be_k \\
\PD{\phi}{x_k} &= r \PD{\phi}{\rcap} \cdot \Be_k.
\end{align}
\end{subequations}

The last two derivatives can be calculated easily if the radial unit vector is written out explicitly, with $S$ and $C$ for sine and cosine respectively, these are

\begin{subequations}\label{eqn:jacobianSphericalPolar:6}
\begin{align}
\rcap &= 
\begin{bmatrix}
S_\theta C_\phi \\
S_\theta S_\phi \\
C_\theta 
\end{bmatrix} \\
\PD{\theta}{\rcap} &= 
\begin{bmatrix}
C_\theta C_\phi \\
C_\theta S_\phi \\
-S_\theta 
\end{bmatrix} \\
\PD{\phi}{\rcap} &= 
\begin{bmatrix}
-S_\theta S_\phi \\
S_\theta C_\phi \\
0
\end{bmatrix} 
.
\end{align}
\end{subequations}

We can plug these into the elements of the Jacobian matrix explicitly, which produces

\begin{align}\label{eqn:jacobianSphericalPolar:7}
\frac{\partial (x,y,z)}{\partial (r,\theta,\phi)}
=
\begin{bmatrix} 
S_\theta C_\phi & S_\theta S_\phi & C_\theta \\
r C_\theta C_\phi & r C_\theta S_\phi & - r S_\theta \\
-r S_\theta S_\phi & rS_\theta C_\phi & 0
\end{bmatrix},
\end{align}

however, we are probably better off just referring back to \ref{eqn:jacobianSphericalPolar:6}, and writing 

\begin{align}\label{eqn:jacobianSphericalPolar:7a}
\frac{\partial (x,y,z)}{\partial (r,\theta,\phi)}
=
\begin{bmatrix} 
\rcap^\T \\
r \PD{\theta}{\rcap^\T} \\
r \PD{\phi}{\rcap^\T} 
\end{bmatrix}.
\end{align}

Unfortunately, this is actually a bit of a dead end.  We really want the inverse of this matrix because the desired quanity is

\begin{align}\label{eqn:jacobianSphericalPolar:8}
\spacegrad = 
\begin{bmatrix}
\Be_1 & \Be_2 & \Be_3  
\end{bmatrix}
\begin{bmatrix}
\partial_{x_1} \\
\partial_{x_2} \\
\partial_{x_3}
\end{bmatrix}.
\end{align}

(Here my matrix of unit vectors treats these abusively as single elements and not as column vectors).

The matrix of equation \ref{eqn:jacobianSphericalPolar:7a} does not look particularily fun to invert directly, and that is what we need to substuite into
\ref{eqn:jacobianSphericalPolar:8}.  One knows that in the end if it was attempted things should mystically simplify (presuming this was done error free).

\section{Cartesian gradient coordinates in terms of spherical polar partials.}

Let's flip things upside down and calculate the inverse Jacobian matrix directly.  This is a messier job, but it appears less messy than the matrix inversion above.

\begin{subequations}\label{eqn:jacobianSphericalPolar:9}
\begin{align}
r^2 &= x^2 + y^2 + z^2  \\
\sin^2 \theta &= \frac{x^2 + y^2}{x^2 + y^2 + z^2} \\
\tan\phi &= \frac{y}{x}
.
\end{align}
\end{subequations}

The messy task is now the calculation of these derivatives.

For the first, from $r^2 = x^2 + y^2 + z^2$, taking partials on both sides, we have

\begin{align}\label{eqn:jacobianSphericalPolar:10}
\PD{x_k}{r} = \frac{x_k}{r}.
\end{align}

But these are just the direction cosines, the components of our polar unit vector $\rcap$.  We can then write for all of these derivatives in column matrix form

\begin{align}\label{eqn:jacobianSphericalPolar:11}
\spacegrad r = \rcap
\end{align}

Next from $\sin^2\theta = (x^2 + y^2)/r^2$, we get after some reduction

\begin{subequations}\label{eqn:jacobianSphericalPolar:12}
\begin{align}
\PD{x}{\theta} &= \inv{r} C_\theta C_\phi \\
\PD{y}{\phi} &= \inv{r} C_\theta S_\phi \\
\PD{z}{\phi} &= -\frac{S_\theta}{r}.
\end{align}
\end{subequations}

Observe that we can antidifferentiate with respect to theta and obtain

\begin{align*}
\spacegrad \theta &= 
\inv{r}
\begin{bmatrix}
C_\theta C_\phi \\
C_\theta S_\phi \\
-S_\theta
\end{bmatrix} \\
&=
\inv{r}
\PD{\theta}{}
\begin{bmatrix}
S_\theta C_\phi \\
S_\theta S_\phi \\
C_\theta
\end{bmatrix}.
\end{align*}

This last column vector is our friend the unit polar vector again, and we have

\begin{align}\label{eqn:jacobianSphericalPolar:13}
\spacegrad \theta &= 
\inv{r}
\PD{\theta}{\rcap}
\end{align}

Finally for the $\phi$ dependence we have after some reduction

\begin{align}\label{eqn:jacobianSphericalPolar:14}
\spacegrad \phi &=
\inv{r S_\theta}
\begin{bmatrix}
-S_\phi \\
C_\phi \\
0
\end{bmatrix}.
\end{align}

Again, we can antidifferentiate

\begin{align*}
\spacegrad \phi 
&=
\inv{r (S_\theta)^2}
\begin{bmatrix}
-S_\theta S_\phi \\
S_\theta C_\phi \\
0
\end{bmatrix} \\
&=
\inv{r (S_\theta)^2}
\PD{\phi}{}
\begin{bmatrix}
S_\theta C_\phi \\
S_\theta S_\phi \\
C_\theta
\end{bmatrix}.
\end{align*}

We have our unit polar vector again, and our $\phi$ partials nicely summarized by

\begin{align}\label{eqn:jacobianSphericalPolar:15}
\spacegrad \phi 
&=
\inv{r (S_\theta)^2}
\PD{\phi}{\rcap}.
\end{align}

With this we can now write out the Jacobian matrix either explicitly, or in column vector form in terms of $\rcap$.  First a reminder of why we want this matrix, for the following change of variables

\begin{align}\label{eqn:jacobianSphericalPolar:16}
\begin{bmatrix}
\partial_x \\
\partial_y \\
\partial_z
\end{bmatrix}
= 
\begin{bmatrix}
\PD{x}{r} &\PD{x}{\theta} &\PD{x}{\phi}  \\
\PD{y}{r} &\PD{y}{\theta} &\PD{y}{\phi}  \\
\PD{z}{r} &\PD{z}{\theta} &\PD{z}{\phi} 
\end{bmatrix}
\begin{bmatrix}
\partial_r \\
\partial_\theta \\
\partial_\phi
\end{bmatrix}
.
\end{align}

We want the Jacobian matrix

\begin{align}\label{eqn:jacobianSphericalPolar:17}
\frac{\partial (r,\theta,\phi)}{\partial (x, y, z)}
=
\begin{bmatrix}
\spacegrad r & \spacegrad \theta & \spacegrad \phi
\end{bmatrix}
=
\begin{bmatrix}
\rcap & \inv{r} \PD{\theta}{\rcap} & \inv{r \sin^2\theta} \PD{\phi}{\rcap}
\end{bmatrix}.
\end{align}

Explicitly this is

\begin{align}\label{eqn:jacobianSphericalPolar:18}
\frac{\partial (r,\theta,\phi)}{\partial (x, y, z)}
=
\begin{bmatrix}
S_\theta C_\phi & \inv{r} C_\theta C_\phi & -\inv{r S_\theta} S_\phi \\
S_\theta S_\phi & \inv{r} C_\theta S_\phi & \frac{C_\phi}{r S_\theta} \\
C_\theta        & -\inv{r} S_\theta       &  0
\end{bmatrix}.
\end{align} 

As a verification of correctness multiplication of this with \ref{eqn:jacobianSphericalPolar:7} should produce identity.  That's a mess of trig that I don't really feel like trying, but we can get a rough idea why it should all be the identity matrix by multiplying it out in block matrix form

\begin{align*}
\frac{\partial (x,y,z)}{\partial (r,\theta,\phi)}
\frac{\partial (r,\theta,\phi)}{\partial (x, y, z)}
&=
\begin{bmatrix} 
\rcap^\T \\
r \PD{\theta}{\rcap^\T} \\
r \PD{\phi}{\rcap^\T} 
\end{bmatrix}
\begin{bmatrix}
\rcap & \inv{r} \PD{\theta}{\rcap} & \inv{r \sin^2\theta} \PD{\phi}{\rcap}
\end{bmatrix} \\
&=
\begin{bmatrix} 
\rcap^\T \rcap                & \inv{r} \rcap^\T \PD{\theta}{\rcap}      & \inv{r \sin^2 \theta} \rcap^\T \PD{\phi}{\rcap} \\
r \PD{\theta}{\rcap^\T} \rcap & \PD{\theta}{\rcap^\T} \PD{\theta}{\rcap} & \inv{\sin^2\theta} \PD{\theta}{\rcap^\T} \PD{\phi}{\rcap} \\
r \PD{\phi}{\rcap^\T} \rcap   & \PD{\phi}{\rcap^\T} \PD{\theta}{\rcap}   & \inv{\sin^2\theta} \PD{\phi}{\rcap^\T} \PD{\phi}{\rcap}
\end{bmatrix}.
\end{align*}

The derivatives are vectors that lie tangential to the unit sphere.  We can calculate this to verify, or we can look at the off diagonal terms which say just this if we trust the math that says these should all be zeros.  For each of the off diagonal terms to be zero must mean that we have

\begin{align}\label{eqn:jacobianSphericalPolar:19}
0 = \PD{\theta}{\rcap} \cdot \rcap = \PD{\theta}{\rcap} \cdot \PD{\phi}{\rcap} = \PD{\phi}{\rcap} \cdot \rcap 
\end{align}

This makes intuitive sense.  We can also verify quicky enough that $(\PDi{\theta}{\rcap})^2 = 1$, and $(\PDi{\phi}{\rcap})^2 = \sin^2\theta$ (I did this with a back of the envelope calculation using geometric algebra).  That is consistent with what this matrix product implies it should equal.

\section{Completing the gradient change of variables to spherical polar coordinates.}

We are now set to calculate the gradient in spherical polar coordinates from our cartesian representation.  From \ref{eqn:jacobianSphericalPolar:8} and
\ref{eqn:jacobianSphericalPolar:16}, and \ref{eqn:jacobianSphericalPolar:17} we have

\begin{align}\label{eqn:jacobianSphericalPolar:20}
\spacegrad =
\begin{bmatrix}
\Be_1 & \Be_2 & \Be_3  
\end{bmatrix}
\begin{bmatrix}
\rcap \cdot \Be_1 & \inv{r} \PD{\theta}{\rcap} \cdot \Be_1 & \inv{r \sin^2\theta} \PD{\phi}{\rcap} \cdot \Be_1 \\
\rcap \cdot \Be_2 & \inv{r} \PD{\theta}{\rcap} \cdot \Be_2 & \inv{r \sin^2\theta} \PD{\phi}{\rcap} \cdot \Be_2 \\
\rcap \cdot \Be_3 & \inv{r} \PD{\theta}{\rcap} \cdot \Be_3 & \inv{r \sin^2\theta} \PD{\phi}{\rcap} \cdot \Be_3 
\end{bmatrix}
\begin{bmatrix}
\partial_r \\
\partial_\theta \\
\partial_\phi
\end{bmatrix}.
\end{align}

The Jacobian matrix has been written out explicitly as scalars because we are now switching to an abusive notation using matrixes of vector elements.  Our Jacobian, a matrix of scalars happened to have a nice compact representation in column vector form, but we cannot use this when multiplying out with our matrix elements (or perhaps could if we invented more conventions, but lets avoid that).  Having written it out in full we see that we recover our original compact Jacobian representation, and have just

\begin{align}\label{eqn:jacobianSphericalPolar:21}
\spacegrad = 
\begin{bmatrix}
\rcap & \inv{r} \PD{\theta}{\rcap} & \inv{r \sin^2\theta} \PD{\phi}{\rcap} 
\end{bmatrix}
\begin{bmatrix}
\partial_r \\
\partial_\theta \\
\partial_\phi
\end{bmatrix}.
\end{align}

Expanding this last product we have the gradient in its spherical polar representation

\begin{align}\label{eqn:jacobianSphericalPolar:22}
\spacegrad = 
\begin{bmatrix}
\rcap \PD{r}{} + \inv{r} \PD{\theta}{\rcap} \PD{\theta}{} + \inv{r \sin\theta} \inv{\sin\theta} \PD{\phi}{\rcap} \PD{\phi}{}
\end{bmatrix}.
\end{align}

With the labels 
\begin{subequations}
\begin{align}\label{eqn:jacobianSphericalPolar:23}
\thetacap &= \PD{\theta}{\rcap} \\
\phicap &= \inv{\sin\theta} \PD{\phi}{\rcap},
\end{align}
\end{subequations}

(having confirmed that these are unit vectors), we have the final result for the gradient in this representation

\begin{align}\label{eqn:jacobianSphericalPolar:24}
\spacegrad = 
\rcap \PD{r}{} + \inv{r} \thetacap \PD{\theta}{} + \inv{r \sin\theta} \phicap \PD{\phi}{}.
\end{align}

Here the matrix delimiters for the remaining one by one matrix term were also dropped.

%\EndArticle
\EndNoBibArticle
