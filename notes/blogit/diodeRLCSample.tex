%
% Copyright © 2014 Peeter Joot.  All Rights Reserved.
% Licenced as described in the file LICENSE under the root directory of this GIT repository.
%
\input{../blogpost.tex}
\renewcommand{\basename}{diodeRLCSample}
\renewcommand{\dirname}{notes/ece1254/}
%\newcommand{\dateintitle}{}
%\newcommand{\keywords}{}

\input{../peeter_prologue_print2.tex}

\beginArtNoToc

\generatetitle{A sample diode RLC circuit}
%\chapter{A sample diode RLC circuit}
%\label{chap:diodeRLCSample}

To get a feel for how to generate the MLN equations for a circuit that has both RLC and non-linear components, consider the circuit of \cref{fig:diodeRLC:diodeRLCFig1}.

%\imageFigure{../../figures/ece1254/diodeRLCFig1}{An RLC circuit with a diode.}{fig:diodeRLC:diodeRLCFig1}{0.3}
%\imageFigure{../../figures/ece1254/diodeRLCFig3}{An RLC circuit with a diode.}{fig:diodeRLC:diodeRLCFig1}{0.1}
\imageFigure{../../figures/ece1254/diodeRLCFig4}{An RLC circuit with a diode.}{fig:diodeRLC:diodeRLCFig1}{0.2}

The KCL equations for this circuit are

\begin{enumerate}
\item \( 0 = i_s - i_d \)
\item \( i_L + \frac{v_2 - v_3}{R} = i_d \)
\item \( \frac{v_3 - v_2}{R} + C \frac{dv_3}{dt} = 0 \)
\item \( -v_2 + L \frac{d i_L}{dt} = 0 \)
\item \( i_d = I_0 \lr{ e^{(v_1 - v_2)/v_T} - 1} \)
\end{enumerate}

%FIXME: for the diode, is that the right voltage sign with respect to the current direction?

With \( Z = 1/R \), these can be put into the standard MLN matrix form as

\begin{equation}\label{eqn:diodeRLCSample:20}
\begin{bmatrix}
0 & 0 & 0 & 0 \\
0 & Z & -Z & 1 \\
0 & -Z & Z & 0 \\
0 & -1 & 0 & 0 \\
\end{bmatrix}
\begin{bmatrix}
v_1 \\
v_2 \\
v_3 \\
i_L \\
\end{bmatrix}
+
\begin{bmatrix}
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & C & 0 \\
0 & 0 & 0 & L \\
\end{bmatrix}
{\begin{bmatrix}
v_1 \\
v_2 \\
v_3 \\
i_L \\
\end{bmatrix}}'
=
\begin{bmatrix}
 I_0 & 1 \\
 -I_0 & 0 \\
 0  & 0 \\
 0  & 0 \\
\end{bmatrix}
\begin{bmatrix}
1 \\
i_s(t) \\
\end{bmatrix}
+
\begin{bmatrix}
-I_0 \\
 I_0 \\
 0  \\
 0  \\
\end{bmatrix}
\begin{bmatrix}
e^{(v_2 - v_3)/v_T}
\end{bmatrix}
\end{equation}

Let's write this as 

\begin{equation}\label{eqn:diodeRLCSample:40}
\BG \BX(t) + \BC \dot{\BX}(t) = \BB \Bu(t) + \BD \Bw(t).
\end{equation}

Here \( \Bu(t) \) collects up all the unique signature sources (for example sources with each different frequency in the system), and \( \Bw(t) \) is a vector of all the unique non-linear (time dependent) terms.

Assuming a bandwidth limited periodic source we know how to express any of the time dependent variables \( v_1, ... \) in terms of their (discrete) Fourier transforms.  Suppose that 
%\( V_n^{(a)} \), \( U_n^{(b)} \), and \( W_n^{(c)} \) are 
the Fourier coefficients for \( v_a(t), u_b(t), w_c(t) \) are given by

\begin{equation}\label{eqn:diodeRLCSample:60}
\begin{aligned}
v_a(t) &= \sum_{n = -N}^N V_n^{(a)} e^{j \omega_0 n t} \\
u_b(t) &= \sum_{n = -N}^N U_n^{(b)} e^{j \omega_0 n t} \\
w_c(t) &= \sum_{n = -N}^N W_n^{(c)} e^{j \omega_0 n t}.
\end{aligned}
\end{equation}

For example, in this circuit, if the source was zero phase signal at the fundamental frequency of our Fourier basis (\( i_s(t) = e^{j \omega_0 t} \)), the only non-zero Fourier components \( U_n^{(a)} \) would be \( U_0^{(1)} = 1, U_1^{(2)} = 1 \).

First evaluating the derivatives, and then evaluating the result at each of the Nykvist times \( t_k \), yields a \( (2 N + 1) \times 1 \) equations

\begin{equation}\label{eqn:diodeRLCSample:80}
0 = \sum_{n=-N}^N 
e^{j n \omega_0 t_k}
\lr{
\lr{
\BG + j \omega_0 n \BC
}
\begin{bmatrix}
V_n^{(1)} \\
V_n^{(2)} \\
\vdots
\end{bmatrix}
-
\BB
\begin{bmatrix}
U_n^{(1)} \\
U_n^{(2)} \\
\end{bmatrix}
-\BD
\begin{bmatrix}
W_n^{(1)} \\
\end{bmatrix}
}
\end{equation}

With the assumption of periodicity, each of these equations must separately equal zero for each \( ( n, k ) \) pair so that

\begin{equation}\label{eqn:diodeRLCSample:240}
\lr{
\BG + j \omega_0 n \BC
}
\begin{bmatrix}
V_n^{(1)} \\
V_n^{(2)} \\
\vdots
\end{bmatrix}
=
\BB
\begin{bmatrix}
U_n^{(1)} \\
U_n^{(2)} \\
\end{bmatrix}
+\BD
\begin{bmatrix}
W_n^{(1)} \\
\end{bmatrix}
\end{equation}

The next goal is to put this in block matrix form.  First introducing discrete time sampling vectors 

\begin{equation}\label{eqn:diodeRLCSample:100}
\Bv_a = 
\begin{bmatrix}
v_a(t_{-N}) \\
v_a(t_{1-N}) \\
\vdots \\
v_a(t_{N-1}) \\
v_a(t_{N}) \\
\end{bmatrix}, \qquad
\Bu_a = 
\begin{bmatrix}
u_b(t_{-N}) \\
u_b(t_{1-N}) \\
\vdots \\
u_b(t_{N-1}) \\
u_b(t_{N}) \\
\end{bmatrix}, \qquad
\Bw_a = 
\begin{bmatrix}
w_c(t_{-N}) \\
w_c(t_{1-N}) \\
\vdots \\
w_c(t_{N-1}) \\
w_c(t_{N}) \\
\end{bmatrix},
\end{equation}

and Fourier component vectors

\begin{equation}\label{eqn:diodeRLCSample:120}
\BV_a = 
\begin{bmatrix}
V^{(a)}_{-N} \\
V^{(a)}_{1-N} \\
\vdots \\
V^{(a)}_{N-1} \\
V^{(a)}_{N} \\
\end{bmatrix}, \qquad
\BU_b = 
\begin{bmatrix}
U^{(b)}_{-N} \\
U^{(b)}_{1-N} \\
\vdots \\
U^{(b)}_{N-1} \\
U^{(b)}_{N} \\
\end{bmatrix}, \qquad
\BW_c = 
\begin{bmatrix}
W^{(c)}_{-N} \\
W^{(c)}_{1-N} \\
\vdots \\
W^{(c)}_{N-1} \\
W^{(c)}_{N} \\
\end{bmatrix}.
\end{equation}

With \( \alpha = e^{ 2 \pi j /(2 N + 1) } \), and

\begin{equation}\label{eqn:diodeRLCSample:140}
\BF = 
\begin{bmatrix}
 \alpha^{ N N } &  \alpha^{ \lr{N-1} N }  & \cdots & 1 & \cdots &  \alpha^{ -\lr{N-1} N }  &  \alpha^{ -N N } \\
 \alpha^{ N \lr{N-1} } &  \alpha^{ \lr{N-1} \lr{N-1} }  & \cdots & 1 & \cdots &  \alpha^{ -\lr{N-1} \lr{N-1} }  &  \alpha^{ -N \lr{N-1} } \\
 \vdots              &  \vdots                      & \vdots      & \vdots & \vdots      &  \vdots                    &  \vdots               \\
 1              &  1                      & 1      & 1 & 1      &  1                    &  1               \\
 \vdots              &  \vdots                      & \vdots      & \vdots & \vdots      &  \vdots                    &  \vdots               \\
 \alpha^{ -N \lr{N-1} } &  \alpha^{ -\lr{N-1} \lr{N-1} }  & \cdots & 1 & \cdots &  \alpha^{ {N-1} \lr{N-1} }  &  \alpha^{ N \lr{N-1} } \\
 \alpha^{ -N N } &  \alpha^{ -N N }  & \cdots & 1 & \cdots &  \alpha^{ \lr{N-1} N }  &  \alpha^{ N N } \\
\end{bmatrix},
\end{equation}

in each case the time domain sampling vectors are related to the Fourier components by relations of the form

\begin{equation}\label{eqn:diodeRLCSample:160}
\Bx = \BF \BX.
\end{equation}

\section{Block matrix form, with physical parameter ordering}

To understand how to put \cref{eqn:diodeRLCSample:240} in block matrix form, it is helpful to consider a specific example.  Consider again the specific example of the RLC circuit above, which has the form

\begin{equation}\label{eqn:diodeRLCSample:260}
\begin{bmatrix}
0 & 0 & 0 & 0 \\
0 & Z & -Z & 1 \\
0 & -Z & Z + j \omega_0 n C & 0 \\
0 & -1 & 0 & + j \omega_0 n L \\
\end{bmatrix}
\begin{bmatrix}
V_n^{(1)} \\
V_n^{(2)} \\
V_n^{(3)} \\
I_n^{(L)} \\
\end{bmatrix}
=
\begin{bmatrix}
I_n^{(1)} \\
I_n^{(2)} \\
I_n^{(3)} \\
I_n^{(4)} \\
\end{bmatrix}
\end{equation}

Here the \( I^{(i)} \) terms are the DFT representations of both the linear and non-linear sources.  

Suppose for example that \( N = 1 \).  One way to write \cref{eqn:diodeRLCSample:260} would be

\begin{equation}\label{eqn:diodeRLCSample:320}
\begin{aligned}
&
\begin{bmatrix}
I_{-1}^{(1)} \\
I_0^{(1)} \\
I_{1}^{(1)} \\
I_{-1}^{(2)} \\
I_0^{(2)} \\
I_{1}^{(2)} \\
I_{-1}^{(3)} \\
I_0^{(3)} \\
I_{1}^{(3)} \\
I_{-1}^{(4)} \\
I_0^{(4)} \\
I_{1}^{(4)} \\
\end{bmatrix}
=
\left[
\begin{array}{c|c|c|c}
% row 1:
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} \\ \hline
% row 2:
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
Z & 0 & 0 \\
0 & Z & 0 \\
0 & 0 & Z \\
\end{matrix} &
\begin{matrix}
-Z & 0 & 0 \\
0 & -Z & 0 \\
0 & 0 & -Z \\
\end{matrix} &
\begin{matrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1 \\
\end{matrix} \\ \hline
% row 3:
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
-Z & 0 & 0 \\
0 & -Z & 0 \\
0 & 0 & -Z \\
\end{matrix} &
\begin{matrix}
Z & 0 & 0 \\
0 & Z & 0 \\
0 & 0 & Z \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} \\ \hline
% row 4:
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
-1 & 0 & 0 \\
0 & -1 & 0 \\
0 & 0 & -1 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} \\
\end{array}
\right]
\begin{bmatrix}
V_{-1}^{(1)} \\
V_{0}^{(1)} \\
V_{1}^{(1)} \\
V_{-1}^{(2)} \\
V_{0}^{(2)} \\
V_{1}^{(2)} \\
V_{-1}^{(3)} \\
V_{0}^{(3)} \\
V_{1}^{(3)} \\
I_{-1}^{(L)} \\
I_{0}^{(L)} \\
I_{1}^{(L)} \\
\end{bmatrix} \\
&+
\left[
\begin{array}{c|c|c|c}
% row 1:
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} \\ \hline
% row 2:
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} \\ \hline
% row 3:
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
j \omega_0 (-1) C & 0 & 0 \\
0 & j \omega_0 (0) C & 0 \\
0 & 0 & j \omega_0 (1) C \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} \\ \hline
% row 4:
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
\end{matrix} &
\begin{matrix}
j \omega_0 (-1) L & 0 & 0 \\
0 & j \omega_0 (0) L & 0 \\
0 & 0 & j \omega_0 (1) L \\
\end{matrix} \\
\end{array}
\right]
\begin{bmatrix}
V_{-1}^{(1)} \\
V_{0}^{(1)} \\
V_{1}^{(1)} \\
V_{-1}^{(2)} \\
V_{0}^{(2)} \\
V_{1}^{(2)} \\
V_{-1}^{(3)} \\
V_{0}^{(3)} \\
V_{1}^{(3)} \\
I_{-1}^{(L)} \\
I_{0}^{(L)} \\
I_{1}^{(L)} \\
\end{bmatrix} \\
\end{aligned}
\end{equation}

With a vector of fourier coeffient vectors

\begin{equation}\label{eqn:diodeRLCSample:280}
\BV =
\begin{bmatrix}
\BV^{(1)} \\
\BV^{(2)} \\
\BV^{(3)} \\
\BI^{(L)}
\end{bmatrix}, \qquad
\BI =
\begin{bmatrix}
\BI^{(1)} \\
\BI^{(2)} \\
\BI^{(3)} \\
\BI^{(4)}
\end{bmatrix}.
\end{equation}

and a \( (2 N + 1) \times (2 N + 1) \) matrix of indexes

\begin{equation}\label{eqn:diodeRLCSample:220}
\BN = 
\begin{bmatrix}
-N &     &        &     &    \\
  & 1-N &        &     &    \\
  &     & \ddots &     &    \\
  &     &        & N-1 &    \\
  &     &        &     & N \\
\end{bmatrix},
\end{equation}

the complete block diagonalization is

%\begin{equation}\label{eqn:diodeRLCSample:300}
\boxedEquation{eqn:diodeRLCSample:300}{
{\begin{bmatrix}
g_{rs} \BI_{2 N + 1} + 
j \omega_0 c_{rs} \BN 
\end{bmatrix}
}_{rs}
\BV
= 
\BI.
}
%\end{equation}

\section{Block matrix form, with frequency ordering}

It turns out that a better way of ordering the vector of Fourier components is using a frequency ordering that interleaves the physical parameters.  With such an ordering the DFT MNA equations are

\begin{equation}\label{eqn:diodeRLCSample:340}
\begin{aligned}
\BI =
&\begin{bmatrix}
I_{-1}^{(1)} \\
I_{-1}^{(2)} \\
I_{-1}^{(3)} \\
I_{-1}^{(4)} \\
I_0^{(1)} \\
I_0^{(2)} \\
I_0^{(3)} \\
I_0^{(4)} \\
I_{1}^{(1)} \\
I_{1}^{(2)} \\
I_{1}^{(3)} \\
I_{1}^{(4)} \\
\end{bmatrix}
+
\left[
\begin{array}{c|c|c}
\begin{matrix}
0 & 0  & 0  & 0  \\
0 & Z  & -Z & 1 \\
0 & -Z & Z & 0 \\
0 & -1 & 0 & 0 \\
\end{matrix} & 0 & 0 \\ \hline
0 & 
\begin{matrix}
0 & 0  & 0  & 0 \\
0 & Z  & -Z & 1 \\
0 & -Z & Z & 0 \\
0 & -1 & 0 & 0 \\
\end{matrix} & 0 \\ \hline
0 & 0 & 
\begin{matrix}
0 & 0  & 0  & 0 \\
0 & Z  & -Z & 1 \\
0 & -Z & Z & 0 \\
0 & -1 & 0 & 0 \\
\end{matrix} \\
\end{array}
\right]
\begin{bmatrix}
V_{-1}^{(1)} \\
V_{-1}^{(2)} \\
V_{-1}^{(3)} \\
I_{-1}^{(L)} \\
V_{0}^{(1)} \\
V_{0}^{(2)} \\
V_{0}^{(3)} \\
I_{0}^{(L)} \\
V_{1}^{(1)} \\
V_{1}^{(2)} \\
V_{1}^{(3)} \\
I_{1}^{(L)} \\
\end{bmatrix} \\
&+
j \omega_0 
\left[
\begin{array}{c|c|c}
(-1)
\begin{bmatrix}
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & C & 0 \\
0 & 0 & 0 & L \\
\end{bmatrix} & 0 & 0 \\ \hline
0 & 
(0)
\begin{bmatrix}
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & C & 0 \\
0 & 0 & 0 & L \\
\end{bmatrix} & 0 \\ \hline
0 & 0 & 
(1)
\begin{bmatrix}
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & C & 0 \\
0 & 0 & 0 & L \\
\end{bmatrix} \\
\end{array}
\right]
\begin{bmatrix}
V_{-1}^{(1)} \\
V_{-1}^{(2)} \\
V_{-1}^{(3)} \\
I_{-1}^{(L)} \\
V_{0}^{(1)} \\
V_{0}^{(2)} \\
V_{0}^{(3)} \\
I_{0}^{(L)} \\
V_{1}^{(1)} \\
V_{1}^{(2)} \\
V_{1}^{(3)} \\
I_{1}^{(L)} \\
\end{bmatrix} \\
\end{aligned}
\end{equation}

This ordering matches that of \citep{giannini2004NonlinearMicrowaveCircuitDesign}.

\section{Representing the linear sources}

Assuming real sources with frequencies that are only multiples of the fundamental harmonic, a reasonable way to represent them in storage is with a pair of matrices

\begin{equation}\label{eqn:diodeRLCSample:360}
\begin{bmatrix}
\BI \sim \BB \Bomega
\end{bmatrix}.
\end{equation}

If \( R \) is the dimension of \(\BG\) and \( \BC \), then \( \BB \) is a \( R \times S \) dimension matrix, where \( S \) is the sum of

\begin{itemize}
\item 1, if there are any DC sources, plus
\item 2 times the number of unique frequency sources.
\end{itemize}

For example, if there is a DC source and one AC source with frequency \( \nu \), then for column vectors \( \Bb_i \) this pair is of the form

\begin{equation}\label{eqn:diodeRLCSample:380}
\BU \Bomega =
\begin{bmatrix}
\Bb_{-1} & \Bb_0 & \Bb_1
\end{bmatrix}
\begin{bmatrix}
- 2 \pi \nu \\
0 \\
2 \pi \nu
\end{bmatrix}.
\end{equation}

This representation produces the time domain representation exactly when there are only DC sources, and can be used to construct the Fourier coefficients by inspection when there are AC sources.  For example, for \( N = 1 \) in the example above, the Fourier coefficent vector is 

\begin{equation}\label{eqn:diodeRLCSample:400}
\BI 
=
\begin{bmatrix}
\Bb_{-1} \\
\Bb_{0} \\
\Bb_{1} \\
\end{bmatrix}.
\end{equation}

If \( N = 2 \) was used, then we would have instead

\begin{equation}\label{eqn:diodeRLCSample:420}
\BI 
=
\begin{bmatrix}
\Bzero \\
\Bb_{-1} \\
\Bb_{0} \\
\Bb_{1} \\
\Bzero \\
\end{bmatrix}.
\end{equation}

\section{Representing non-linear sources}

The time domain MNA \cref{eqn:diodeRLCSample:40} include a wide range of matrix dimensions.  It is now clear how to handle the transition to the frequency domain for all the linear terms.  Working a simple diode example to understand how to handle the non-linear terms is useful.  Consider the circuit of \cref{fig:diodeWithResistor:diodeWithResistorFig1}.

\imageFigure{../../figures/ece1254/diodeWithResistorFig1}{Simple diode circuit}{fig:diodeWithResistor:diodeWithResistorFig1}{0.3}

With \( Z = 1/R, Z_g = 1/R_g \), the KCL equations are

\begin{enumerate}
\item \( \lr{ v_1 - v_2 } Z_s = i_s - i_d \)
\item \( \lr{ v_2 - v_1 } Z_s + v_2 Z_g = -i_s + i_d \)
\end{enumerate}

Using the model \( i_d = I^{(0)} \lr{ e^{ (v_1 - v_2)/V_T } - 1 } \), with source \( i_s = I^{(s)} \cos( \omega_0 t ) \),
this has the block matrix form

\begin{subequations}
\begin{equation}\label{eqn:diodeRLCSample:580}
\BG = 
\begin{bmatrix}
Z_s & -Z_s \\
-Z_s & Z_s + Z_g \\
\end{bmatrix}, \qquad
\Bx = 
\begin{bmatrix}
v_1(t) \\
v_2(t) \\
\end{bmatrix}
\end{equation}
\begin{equation}\label{eqn:diodeRLCSample:600}
\BB =
\begin{bmatrix}
I^{(s)}/2 & -I^{(0)} & I^{(s)}/2 \\
-I^{(s)}/2 & I^{(0)} & -I^{(s)}/2
\end{bmatrix}, \qquad
\Bu(t) = 
\begin{bmatrix}
e^{-j \omega_0 t} \\
1  \\
e^{j \omega_0 t} 
\end{bmatrix}
\end{equation}
\begin{equation}\label{eqn:diodeRLCSample:620}
\BD
=
\begin{bmatrix}
I^{(0)} \\
-I^{(0)} 
\end{bmatrix}, \qquad
\Bw(t) = e^{(v_1(t) - v_2(t))/V_T}.
\end{equation}
\end{subequations}

If \( E_n \) is the nth DFT coefficient for \( e(t) = e^{(v_1(t) - v_2(t))/V_T} \), then the DFT equations for the \( N = 1 \) DFT is

\begin{equation}\label{eqn:diodeRLCSample:n}
\begin{aligned}
\lr{ V_{-1}^{(1)} - V_{-1}^{(2)} } Z_s &= I^{(s)}/2 - I^{(0)} E_{-1}  \\
\lr{ V_{-1}^{(2)} - V_{-1}^{(1)} } Z_s + V_{-1}^{(2)} Z_g &= -I^{(s)}/2 + I^{(0)} E_{-1}  \\
\lr{ V_{0}^{(1)} - V_{0}^{(2)} } Z_s &= I^{(0)} - I^{(0)} E_{0}  \\
\lr{ V_{0}^{(2)} - V_{0}^{(1)} } Z_s + V_{0}^{(2)} Z_g &= -I^{(0)} + I^{(0)} E_{0}  \\
\lr{ V_{1}^{(1)} - V_{1}^{(2)} } Z_s &= I^{(s)}/2 - I^{(0)} E_{1}  \\
\lr{ V_{1}^{(2)} - V_{1}^{(1)} } Z_s + V_{1}^{(2)} Z_g &= -I^{(s)}/2 + I^{(0)} E_{1} 
\end{aligned}
\end{equation}

Let \( \Bb = [ \Bb_{-1}\, \Bb_0\, \Bb_1 ] \), and \( \BD = [ \Bd_1 ] \).  The block matrix equivalent form, by inspection, is

\begin{equation}\label{eqn:diodeRLCSample:n}
\begin{bmatrix}
\BG & 0 & 0 \\
0 & \BG & 0  \\
0 & 0 & \BG 
\end{bmatrix}
\begin{bmatrix}
V_{-1}^{(1)} \\
V_{-1}^{(2)} \\
V_{0}^{(1)} \\
V_{0}^{(2)} \\
V_{1}^{(1)} \\
V_{1}^{(2)}
\end{bmatrix}
=
\begin{bmatrix}
\Bb_{-1} \\
\Bb_{0} \\
\Bb_{1} \\
\end{bmatrix}
+
\begin{bmatrix}
\Bd_1 E_{-1} \\
\Bd_1 E_{0} \\
\Bd_1 E_{1}
\end{bmatrix}.
\end{equation}

%%%\section{Tensor construction of Harmonic balance equations}
%%%
%%%In tensor form the time domain equations are
%%%
%%%\begin{equation}\label{eqn:diodeRLCSample:500}
%%%0 =
%%%g_{ik} x^{(k)}(t) + c_{ik} x^{(k)}(t) - b_{ir} u^{(r)}(t) - d_{is} w^{(s)}(t).
%%%\end{equation}
%%%
%%%Assuming that both the unknowns vector \( \Bx \) and its derivative have Fourier representations
%%%
%%%\begin{equation}\label{eqn:diodeRLCSample:520}
%%%\begin{aligned}
%%%x^{(k)}(t) &= \sum_{n = -N}^N X_n^{(k)} e^{j \omega_0 n t} \\
%%%\dot{x}^{(k)}(t) &= \sum_{n = -N}^N X_n^{(k)} j \omega_0 n e^{j \omega_0 n t},
%%%\end{aligned}
%%%\end{equation}
%%%
%%%the time domain equations can be written out in terms of the Fourier components as
%%%
%%%\begin{equation}\label{eqn:diodeRLCSample:540}
%%%0 =
%%%\sum_{n = -N}^N
%%%e^{j \omega_0 n t}
%%%\lr{ g_{ik} + c_{ik} j \omega_0 n } X_n^{(k)} - b_{ir} U_n^{(r)} - d_{is} W_n^{(s)}.
%%%\end{equation}
%%%
%%%By assumption of periodicity, this is required to be zero for each unique \( e^{j \omega_0 n t} \), producing the Harmonic Balance (frequency domain), equations
%%%
%%%\begin{equation}\label{eqn:diodeRLCSample:560}
%%%\lr{ g_{ik} + c_{ik} j \omega_0 n } X_n^{(k)} = b_{ir} U_n^{(r)} + d_{is} W_n^{(s)}.
%%%\end{equation}
%%%
%%%Here \( i \in [ 1, R ], n \in [ -N, N ] \), so we have \( R \times (2 N + 1) \) equations to solve.
%%%
\EndArticle
