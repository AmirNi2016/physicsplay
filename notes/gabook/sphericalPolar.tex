\documentclass{article}

\input{../peeters_macros.tex}
\input{../peeters_macros2.tex}

\newcommand{\phicap}[0]{\hat{\boldsymbol{\phi}}}
\newcommand{\Lor}[2]{{{\Lambda^{#1}}_{#2}}}
\newcommand{\ILor}[2]{{{ \{{\Lambda^{-1}\} }^{#1}}_{#2}}}

\usepackage{color,cite,graphicx}
   % use colour in the document, put your citations as [1-4]
   % rather than [1,2,3,4] (it looks nicer, and the extended LaTeX2e
   % graphics package. 
\usepackage{latexsym,amssymb,epsf} % don't remember if these are
   % needed, but their inclusion can't do any damage


\usepackage[bookmarks=true]{hyperref}


\title{Some notes on spherical polar coordinates}
\author{Peeter Joot}
\date{ Nov 13, 2008.  Last Revision: $Date: 2008/11/17 14:13:55 $ }

\begin{document}

\maketitle{}
\tableofcontents

\section{ Motivation. }

Reading the math intro of \cite{zeilik1998iaa}, I found the statement that the gradient in spherical polar form is:

\begin{align*}
\grad &= 
\rcap \PD{r}{}
+\thetacap \inv{r} \PD{\theta}{}
+\phicap \inv{r \sin\phi}\PD{\phi}{}
\end{align*}
FIXME: verify if I recalled this sine term above correctly by doing this derivation.

There was no picture or description showing the conventions for measurement of the angles or directions.
To clarify things and leave a margin note I decided to derive the coordinates and unit vector transformation relationships,
gradient, divergence and curl in spherical polar coordinates.

Although these results can be found in many texts, including the excellent review article \cite{fleischCoords}, 
the exersize of personally working out the details will be worthwhile as a learning exersize since I hadn't attempted this since
way back in my school days.

\subsection{ Conventions. }

\begin{figure}[htp]
\centering
\includegraphics[totalheight=0.4\textheight]{spherical_polar}
\caption{Angles and lengths in spherical polar coordinates}\label{fig:spherical_polar}
\end{figure}

Figure \ref{fig:spherical_polar} illustrates the conventions used in 
these notes.  By inspection, the coordinates can be read off the diagram.

\begin{align}\label{eqn:coordinates}
u &= r \cos\phi \\
x &= u \cos\theta = r \cos\phi \cos\theta \\
y &= u \sin\theta = r \cos\phi \sin\theta \\
z &= r \sin\phi
\end{align}

\subsection{ The unit vectors. }

To calculate the unit vectors $\rcap$, $\thetacap$, $\phicap$ in the spherical polar frame we need to apply two sets of rotations.  The first is a rotation 
in the $x,y$ plane, and the second in the $x', z$ plane.

For the intermediate frame after just the $x,y$ plane rotation we have

\begin{align*}
R_\theta &= \exp(-\Be_{12}\theta/2) \\
\Be_i' &= R_\theta \Be_i R_\theta^\dagger
\end{align*}

Now for the rotational plane for the $\phi$ rotation is

\begin{align*}
\Be_1' \wedge \Be_3 
&= (R_\theta \Be_1 R_\theta^\dagger) \wedge \Be_3 \\
&= \inv{2} ( R_\theta \Be_1 R_\theta^\dagger \Be_3 - \Be_3 R_\theta \Be_1 R_\theta^\dagger ) \\
\end{align*}

Noting that $R_\theta$, having scalar, and $\Be_{12}$ components commutes with $\Be_3$, so we have

\begin{align*}
\Be_1' \wedge \Be_3 
&= R_\theta \inv{2} ( \Be_1 \Be_3 - \Be_3 \Be_1 ) R_\theta^\dagger \\
&= R_\theta \Be_1 \wedge \Be_3 R_\theta^\dagger \\
\end{align*}

Therefore the rotor for the second stage rotation is

\begin{align*}
R_\phi 
&= \exp( - R_\theta \Be_1 \wedge \Be_3 R_\theta^\dagger \phi/2 ) \\
&= \sum \inv{k!} \left( - R_\theta \Be_1 \wedge \Be_3 R_\theta^\dagger \phi/2 \right)^k \\
&= R_\theta \sum \inv{k!} ( - \Be_1 \wedge \Be_3 \phi/2 )^k R_\theta^\dagger \\
&= R_\theta \exp( - \Be_{13} \phi/2 ) R_\theta^\dagger \\
\end{align*}

Composing both sets of rotations one has

\begin{align*}
R(\Bx) 
&= R_\theta \exp( - \Be_{13} \phi/2 ) R_\theta^\dagger R_\theta \Bx R_\theta^\dagger R_\theta \exp( \Be_{13} \phi/2 ) R_\theta^\dagger \\
&= \exp( - \Be_{12} \theta/2 ) \exp( - \Be_{13} \phi/2 ) \Bx \exp( \Be_{13} \phi/2 ) \exp( \Be_{12} \theta/2 ) \\
\end{align*}

Or, more compactly

\begin{align}
R(\Bx) &= R \Bx R^\dagger \\
R &= R_\theta R_\phi \\
R_\phi &= \exp(-\Be_{13}\phi/2) \\
R_\theta &= \exp(-\Be_{12}\theta/2)
\end{align}

Application of these to the $\{\Be_i\}$ basis produces the $\{\rcap, \thetacap, \phicap\}$ basis.  First application 
of $R_\phi$ yields the basis vectors for the intermediate rotation.

\begin{align*}
\begin{array}{l l l}
{R_\phi}\Be_1 {R_\phi}^\dagger &= \Be_1 (\cos\phi + \Be_{13} \sin\phi) &= \Be_1 \cos\phi + \Be_3 \sin\phi \\
{R_\phi}\Be_2 {R_\phi}^\dagger &= \Be_2 R_\phi {R_\phi}^\dagger &= \Be_2 \\
{R_\phi}\Be_3 {R_\phi}^\dagger &= \Be_3 (\cos\phi + \Be_{13} \sin\phi) &= \Be_3 \cos\phi - \Be_1 \sin\phi \\
\end{array}
\end{align*}

Applying the second rotation to $R_\phi(\Be_i)$ we have
\begin{align*}
\rcap 
&= {R_\theta}( \Be_1 \cos\phi + \Be_3 \sin\phi ) {R_\theta}^\dagger \\
&=
\Be_1 \cos\phi (\cos\theta + \Be_{12} \sin\theta)
+ \Be_3 \sin\phi \\
&=
\Be_1 \cos\phi \cos\theta 
+ \Be_2 \cos\phi \sin\theta
+ \Be_3 \sin\phi \\
\thetacap
&= {R_\theta} ( \Be_2 ) {R_\theta}^\dagger \\
&= \Be_2 (\cos\theta + \Be_{12} \sin\theta) \\
&= - \Be_1 \sin\theta + \Be_2 \cos\theta \\
\phicap
&= {R_\theta} ( \Be_3 \cos\phi - \Be_1 \sin\phi ) {R_\theta}^\dagger \\
&= \Be_3 \cos\phi - \Be_1 \sin\phi (\cos\theta + \Be_{12} \sin\theta) \\
&= 
- \Be_1 \sin\phi \cos\theta 
- \Be_2 \sin\phi \sin\theta 
+ \Be_3 \cos\phi
\\
\end{align*}

\subsection{ An alternate pictorical derivation of the unit vectors. }

Somewhat more directly, $\rcap$ can be calculated from the coordinate expression of equation \ref{eqn:coordinates}

\begin{align*}
\rcap 
&= \inv{r} (x, y, z),
\end{align*}

which was found by inspection of the diagram.

For $\thetacap$, again from the figure, observe that it lies in an
latitudinal plane (ie: $x,y$ plane), and is perpendicular to the outwards radial vector in that plane.  That is

\begin{align*}
\thetacap 
&= (\cos\theta \Be_1 + \sin\theta \Be_2) \Be_1 \Be_2 \\
\end{align*}

Lastly, $\phicap$ can be calculated from the dual of $\rcap \wedge \thetacap$

\begin{align*}
\phicap 
&= - \Be_1 \Be_2 \Be_3 (\rcap \wedge \thetacap) \\
\end{align*}

Completing the algebra for the expressions above we have
\begin{align}
\rcap 
&=
\cos\phi \cos\theta \Be_1
+ \cos\phi \sin\theta \Be_2
+ \sin\phi \Be_3 \\
\thetacap 
&= \cos\theta \Be_2 - \sin\theta \Be_1 \\
\rcap \wedge \thetacap 
%&=
%\sin\phi \sin\theta \Be_1 \Be_3 
%- \cos\theta \sin\phi \Be_2 \Be_3 
%+ ( \cos\phi \sin\theta^2 + \cos\phi \cos\theta^2 ) \Be_1 \Be_2  \\
&=
\sin\phi \sin\theta \Be_1 \Be_3 
+ \sin\phi \cos\theta \Be_3 \Be_2 
+ \cos\phi \Be_1 \Be_2 \\
\phicap 
&=
- \sin\phi \cos\theta \Be_1 
- \sin\phi \sin\theta \Be_2 
+ \cos\phi \Be_3 %\\
\end{align}

Sure enough this produces the same result as with the rotor logic.

The rotor approach was purely algebraically and doesn't have
the same reliance on pictures.  That may have
an 
additional advantage
since one can then 
study any frame transformations of the general form $\{\Be_i'\} = \{ R \Be_i R^\dagger \}$, and produce results 
that apply to 
not only spherical polar coordinate systems but others such as the cylindrical polar.

\subsection{ Tensor transformation. }

Considering a linear transformation providing a mapping from one basis to another of the following form

\begin{align*}
f_i = \LL(e_i) = L e_i L^{-1}
\end{align*}

The coordinate representation, or Fourier decomposition, of the vectors in each of these frames is

\begin{align*}
x = x^i e_i = y^j f_j.
\end{align*}

Utilizing a reciprocal frame (ie: not yet requiring an orthonormal frame here), such that $e^i \cdot e_j = {\delta^i}_j$, 
then dot product provide the coordinate transformations
\begin{align*}
x^k e_k \cdot e^k &= y^j f_j \cdot e^k \\
y^j f_j \cdot f^i &= x^k e_k \cdot f^i \\
\implies \\
x^i &= y^j f_j \cdot e^i \\
y^i &= x^j e_j \cdot f^i
\end{align*}

The transformed reciprocal frame vectors can be expressed directly in terms of the initial reciprocal frame $f^i = \LL(e^i)$.  Taking
dot products confirms this

\begin{align*}
(L e_i L^{-1}) \cdot (L e^j L^{-1}) 
&= \gpgradezero{ L e_i L^{-1} L e^j L^{-1} } \\
&= \gpgradezero{ L e_i e^j L^{-1} } \\
&= e_i \cdot e^j \gpgradezero{ L L^{-1} } \\
&= e_i \cdot e^j
\end{align*}

This implies that the forward and inverse coordinate transformations may be summarized as
\begin{align*}
y^i &= x^j e_j \cdot \LL(e^i) \\
x^i &= y^j \LL(e_j) \cdot e^i \\
\end{align*}

Or in matrix form
\begin{align}\label{eqn:coordinateTxTensors}
\Lor{i}{j} &= \LL(e^i) \cdot e_j \\
\ILor{i}{j} &= \LL(e_j) \cdot e^i \\
y^i &= \Lor{i}{j} x^j \\
x^i &= \ILor{i}{j} y^j
\end{align}

The use of inverse notation is justified by the following

\begin{align*}
x^i &= \ILor{i}{k} y^k \\
&= \ILor{i}{k} \Lor{k}{j} x^j \\
\implies \\
\ILor{i}{k} \Lor{k}{j} &= \delta^i_j
\end{align*}

Some references such as \cite{MinahanTensors} use $\Lor{i}{j}$ for both the forward and inverse transformations, with specific conventions
about which index is varied to distinguish the two matrices.  I've found that confusing and have instead used the explicit inverse notation
of \cite{SpenceTensors}.

\subsection{ Gradient after change of coordinates. }

With the transformation matrixes enumerated above we are now equipt to take the gradient expressed in initial frame
\begin{align*}
\grad = \sum e^i \PD{x^i}{},
\end{align*}

and express it in the transformed frame.  The chain rule is required for the derivatives in terms of the transformed coordinates

\begin{align*}
\PD{x^i}{} 
&= \PD{x^i}{y^j} \PD{y^j}{} \\
&= \Lor{j}{i} \PD{y^j}{} \\
&= \LL(e^j) \cdot e_i \PD{y^j}{} \\
&= f^j \cdot e_i \PD{y^j}{}
\end{align*}

Therefore the gradient is
\begin{align*}
\grad &= \sum e^i (f^j \cdot e_i) \PD{y^j}{} \\
      &= \sum f^j \PD{y^j}{} \\
\end{align*}

This gets us most of the way towards the desired result for the spherical polar gradient since all that remains is a calculation of the $\PDi{y^j}{}$
values for
each of the $\rcap$, $\thetacap$, and $\phicap$ directions.

It is also interesting to observe (as in \cite{DenkerMaxwell}) that the gradient can also be written as

\begin{align*}
\grad &= \inv{f_j} \PD{y^j}{} \\
\end{align*}

Observe the similarity to the Fourier component decomposition of the vector itself $x = f_i y^i$.  Thus, roughly speaking, the differential operator
parts of the gradient can be seen to be directional derivatives 
along the directions of each of the frame vectors.

This is sufficient to read the elements of distance in each of the directions
off the figure

\begin{align*}
\delta \Bx \cdot \rcap &= \delta r \\
\delta \Bx \cdot \thetacap &= r \cos\phi \delta \theta \\
\delta \Bx \cdot \phicap &= r \delta \theta \\
\end{align*}

Therefore the gradient is just
\begin{align}
\grad = 
\rcap \PD{r}{}
+\thetacap \inv{r \cos\phi} \PD{\theta}{} 
+\phicap \inv{r} \PD{\phi}{}
\end{align}

Although this last bit has been
derived graphically, and not analyitically, it does
clarify the original question of exactly angle and unit vector 
conventions were intended in the text (polar angle measured from the North pole, not equator, and $\theta$, and $\phi$ reversed).

This was the long way to that particular result, but this has been
an exploratory treatment of frame rotation concepts that I personally 
felt the need to clarity for myself.

There are still some additional details that I will explore before concluding
(including an analyitic treatment of the above).

% FIXME: wrong!
%%%\subsection{ Element of distance along the curves. }
%%%
%%%Using the figure, one can observe that the distances along in each of the spherical polar unit vector directions are obtained in
%%%this particular case by varying each coordinate in turn.
%%%
%%%\begin{itemize}
%%%\item Along $\rcap$, a vectorial element of distance is just
%%%
%%%\begin{align*}
%%%\delta \Bx_r 
%%%&= (r + \delta r)\rcap - r\rcap \\
%%%&= \delta r \rcap.
%%%\end{align*}
%%%
%%%\item Along the $\phicap$ direction?
%%%
%%%Here one wants the great circle path obtained by fixing $\theta$ and $r$.  A difference of such position vectors 
%%%(in the standard basis) is
%%%
%%%\begin{align*}
%%%r 
%%%\begin{bmatrix}
%%%(\cos(\phi + \delta \phi) - \cos(\phi)) \cos(\theta) \\
%%%(\cos(\phi + \delta \phi) - \cos(\phi)) \sin(\theta) \\
%%%\sin(\phi + \delta \phi) - \sin(\phi) \\
%%%\end{bmatrix}
%%%&\approx
%%%r 
%%%\begin{bmatrix}
%%%-\sin(\phi) \cos(\theta) \\
%%%-\sin(\phi) \sin(\theta) \\
%%%\cos(\phi) \\
%%%\end{bmatrix}
%%%\delta \phi
%%%\end{align*}
%%%
%%%This is an unsatisfactory way to express the directed distance, since it is in terms of $\Be_i$.  We have relationships
%%%for $\rcap$, $\thetacap$, $\phicap$ in terms of $\Be_i$ and could invert that and multiply it out, but that is going to
%%%make things even messier before things get simpler.
%%%
%%%Instead form the unit bivector for the north south oriented great circle plane through the point of interest
%%%
%%%\begin{align*}
%%%j = \rcap \wedge \phicap
%%%\end{align*}
%%%
%%%For a point $\Bx$ we want to consider an incremental change in position along the $\phicap$ direction.  Forming the 
%%%projection and rejection from the plane we have
%%%
%%%\begin{align*}
%%%\Bx = \Bx j \inv{j} = (\Bx \cdot j) \inv{j} + (\Bx \wedge j) \inv{j} = \Bx_\parallel + \Bx_\perp
%%%\end{align*}
%%%
%%%So rotating to $\Bx'$ and taking differences we have 
%%%
%%%\begin{align*}
%%%\delta \Bx_\phi 
%%%&= \Bx' - \Bx \\
%%%&= \Bx_\parallel' -\Bx_\parallel \\
%%%&= \Bx_\parallel (\exp(j\delta \phi) - 1) \\
%%%&\approx \Bx_\parallel j \delta \phi \\
%%%&= (\Bx \cdot j) \inv{j} j \delta \phi \\
%%%&= (\Bx \cdot j) \delta \phi
%%%\end{align*}
%%%
%%%\item How about along the $\thetacap$ direction?
%%%Intuitively, one expects the magnitude to be $r \delta \theta$.  The algebra will be exactly the same as with $\phicap$ direction
%%%but we have a different bivector for the plane.  Let $i = \Be_1\Be_2$ we have
%%%
%%%\begin{align*}
%%%\delta \Bx_\theta = (\Bx \cdot i) \delta \theta
%%%\end{align*}
%%%
%%%\end{itemize}
%%%
%%%Now all this is a bit inexact.  What exactly are these $\delta$ increments?  They have to be small enough that they can be considered to be just along the
%%%time unit vectors for the rotated frame.

\subsection{ Notes on transformation of frame vectors vs. coordinates. }

To avoid confusion it is worth noting how the frame vectors vs. the components themselves differ under
rotational transformation.  Consideration of the example of a pair of orthonormal unit vectors for the plane illustrates this

\begin{align*}
\Be_1' &= \Be_1 \exp(\Be_{12}\theta) = \Be_1 \cos\theta + \Be_2 \sin\theta \\
\Be_2' &= \Be_2 \exp(\Be_{12}\theta) = \Be_2 \cos\theta - \Be_1 \sin\theta \\
\end{align*}

Forming a matrix for the transformation of these unit vectors we have
\begin{align*}
\begin{bmatrix}
\Be_1' \\
\Be_2'
\end{bmatrix}
=
\begin{bmatrix}
\cos\theta & \sin\theta \\
- \sin\theta & \cos\theta \\
\end{bmatrix}
\begin{bmatrix}
\Be_1 \\
\Be_2
\end{bmatrix}
\end{align*}

Now compare this to the transformation of a vector in its entirety

\begin{align*}
y^1 e_1 + y^2 e_2 
&= ( x^1 \Be_1 + x^2 \Be_2 ) \exp(\Be_{12}\theta) \\
&= x^1(\Be_1 \cos\theta + \Be_2 \sin\theta) 
 + x^2(\Be_2 \cos\theta - \Be_1 \sin\theta) \\
\end{align*}

And in matrix form this is

\begin{align*}
\begin{bmatrix}
y_1 \\
y_2
\end{bmatrix}
=
\begin{bmatrix}
\cos\theta & -\sin\theta \\
\sin\theta & \cos\theta \\
\end{bmatrix}
\begin{bmatrix}
x_1 \\
x_2
\end{bmatrix}
\end{align*}

Note the inversion of the transformation matrix here compared to the frame vector transformation itself.

%%%\section{ FIXME or delete what comes after this. }
%%%
%%%\subsection{ Expressing spherical polar rotation in matrix form. }
%%%
%%%For the spherical polar case, both sets of frame vectors are orthonormal
%%%
%%%\begin{align*}
%%%\Lor{i}{j}
%%%&= \LL(\Be_i) \cdot \Be_j \\
%%%&= (R^\dagger \Be_i R) \cdot \Be_j \\
%%%\end{align*}
%%%
%%%\begin{align}\label{eqn:rotation}
%%%\Lor{i}{j}
%%%&=
%%%\begin{bmatrix}
%%%%rcap . {e1 e2 e3}
%%%\cos\phi \cos\theta & \cos\phi \sin\theta & \sin\phi \\
%%%%thetacap . {e1 e2 e3}
%%%- \sin\theta & \cos\theta & 0 \\
%%%%phicap . {e1 e2 e3}
%%%- \sin\phi \cos\theta & - \sin\phi \sin\theta & \cos\phi \\
%%%\end{bmatrix}
%%%\end{align}
%%%
%%%From equation \ref{eqn:coordinateTxTensors}, one can see that the inverse transformation is the transpose.  This isn't clear looking at the matrix above until one factors it into a pair of separate matrixes
%%%\begin{align*}
%%%\Lor{i}{j}
%%%&=
%%%\begin{bmatrix}
%%%\cos\phi & 0 & \sin\phi \\
%%%0 & 1 & 0 \\
%%%-\sin\phi & 0 & \cos\phi
%%%\end{bmatrix}
%%%\begin{bmatrix}
%%%\cos\theta & \sin\theta & 0 \\
%%%-\sin\theta & \cos\theta & 0 \\
%%%0 & 0 & 1 \\
%%%\end{bmatrix}
%%%\end{align*}
%%%
%%%FIXME: from my Euler angle notes, I would have expected this matrix factorization to be in inverted order.  There's an inconsistency
%%%or misunderstanding here or there somewhere, but I can't find anything wrong in either place.
%%%
%%%%Hmm, after doing this, which I thought would shed some light on how to transform the gradient (and divergence and curl), but it isn't clear to me
%%%%that this was completely helpful.
%%%
%%%\subsection{ Verification of rotation matrix, using only matrix notation. }
%%%
%%%As a verification of \ref{eqn:rotation} lets calculate that directly.  The initial rotation is in the $x,y$ plane around the $-\Be_2' = -\Be_2 \exp(\Be_{12}\theta) = -\Be_2 \cos\theta + \Be_1 \sin\theta$ axis.
%%%
%%%From \cite{PJRotor} we have the rotation matrix for a $\phi$ rotation about
%%%unit vector $\Bn = (n_1, n_2, n_3) = (-\cos\theta, \sin\theta, 0) = (-C_\theta, S_\theta, 0)$ is
%%%
%%%\begin{align*}
%%%R_\phi R_\theta
%%%=
%%%\begin{bmatrix}
%%%\cos\phi(1 +{C_\theta}^2) - {C_\theta}^2 & -{C_\theta} {S_\theta} (1-\cos\phi) & {S_\theta} \sin\phi \\
%%%-{C_\theta} {S_\theta} (1-\cos\phi) & \cos\phi(1 -{S_\theta}^2) + {S_\theta}^2 & {C_\theta} \sin\phi \\
%%%-{S_\theta} \sin\phi & {-C_\theta} \sin\phi & \cos\phi \\
%%%\end{bmatrix}
%%%\begin{bmatrix}
%%%C_\theta & -S_\theta & 0 \\
%%%S_\theta & C_\theta & 0 \\
%%%0 & 0 & 1 \\
%%%\end{bmatrix}
%%%\end{align*}
%%%

\bibliographystyle{plainnat}
\bibliography{myrefs}

\end{document}
