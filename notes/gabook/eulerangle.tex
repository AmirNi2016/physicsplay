\documentclass{article}

\input{../peeters_macros.tex}
\input{../peeters_macros2.tex}

\usepackage[bookmarks=true]{hyperref}

\title{Some notes on Euler Angles.}
\author{Peeter Joot}
\date{ November 1, 2008. Last Revision: $Date: 2008/11/03 05:52:36 $ }

\begin{document}

\maketitle{}
\tableofcontents

\section{ Removing the rotors from the exponentials. }

In \cite{doran2003gap} section 2.7.5 the Euler angle formula is 
developed for $\{z,x',z''\}$ axis rotations by $\{\phi, \theta, \psi\}$
respectively.

Other than a few details the derivation is pretty straightforward.  Equation
2.153 would be clearer with a series expansion hint like

\begin{align*}
\exp(R \alpha i R^\dagger) 
&= \sum_k \inv{k!} (R \alpha i R^\dagger)^k \\
&= \sum_k \inv{k!} R (\alpha i)^k R^\dagger \\
&= R \exp(\alpha i) R^\dagger
\end{align*}

where $i$ is a bivector, and $R$ is a rotor ($RR^\dagger = 1$).

The first rotation is straightforward, by an angle $\phi$ around the z axis

\begin{align*}
R_\phi(x) = \exp(-Ie_3 \phi/2) x \exp(Ie_3 \phi/2) = R_\phi x R_\phi^\dagger
\end{align*}

The next rotation is around the transformed x axis, for which the rotational plane is
\begin{align*}
I R_\phi e_1 R_\phi^\dagger 
&= R_\phi I e_1 R_\phi^\dagger  \\
\end{align*}

So the rotor for this plane by angle $\theta$ is

\begin{align*}
R_\theta 
&= \exp( R_\phi I e_1 R_\phi^\dagger ) \\
&= R_\phi \exp( I e_1 \theta/2) R_\phi^\dagger,
\end{align*}

resulting in the composite rotor
\begin{align*}
R_{\theta\phi}
&=
R_\theta 
R_\phi \\
&= R_\phi \exp( I e_1 \theta/2) R_\phi^\dagger R_\phi \\
&= R_\phi \exp( I e_1 \theta/2) \\
&= 
\exp{( -I e_3 \phi/2 )}
\exp( -I e_1 \theta/2 ) \\
\end{align*}

The composition of the simple rotation around the $e_3$ axis, followed by the rotation around the $e_1'$ axis ends up
as a product of rotors around the original $e_1$ and $e_3$ axis, but curiously enough in inverted order.

\section{ Expanding the rotor product. }

Completing the calculation outlined above follows in the same fashion.  The 
end result is that the composite Euler rotations has the following rotor form

\begin{align*}
R(x) &= R x R^\dagger \\
R &= \exp(-e_{12}\phi/2) \exp(-e_{23}\theta/2) \exp(-e_{12}\psi/2)
\end{align*}

Then there are notes saying this is easier to visualize and work with than
the equivalent matrix formula.  Let's see what the equivalent matrix formula
is.  First calculate the rotor action on $\Be_1$

\begin{align*}
R \Be_1 R^\dagger
&= 
e^{-e_{12}\phi/2} e^{-e_{23}\theta/2} e^{-e_{12}\psi/2}
\Be_1
e^{e_{12}\psi/2}
e^{e_{23}\theta/2} 
e^{e_{12}\phi/2} \\
&= 
e^{-e_{12}\phi/2} e^{-e_{23}\theta/2} 
\Be_1 e^{e_{12}\psi}
e^{e_{23}\theta/2} 
e^{e_{12}\phi/2} \\
&= 
e^{-e_{12}\phi/2} e^{-e_{23}\theta/2} 
(\Be_1 C_\psi + \Be_2 S_\psi)
e^{e_{23}\theta/2} 
e^{e_{12}\phi/2} \\
&= 
e^{-e_{12}\phi/2} 
(\Be_1 C_\psi + \Be_2 S_\psi e^{e_{23}\theta} )
e^{e_{12}\phi/2} \\
&= 
e^{-e_{12}\phi/2} 
(\Be_1 C_\psi + \Be_2 S_\psi C_\theta + \Be_3 S_\psi S_\theta )
e^{e_{12}\phi/2} \\
&= 
(\Be_1 C_\psi + \Be_2 S_\psi C_\theta ) e^{e_{12}\phi} 
+ \Be_3 S_\psi S_\theta  \\
&= 
  \Be_1 (C_\psi C_\phi - S_\psi C_\theta S_\phi)
+ \Be_2 (C_\psi S_\phi + S_\psi C_\theta C_\phi)
+ \Be_3 S_\psi S_\theta  \\
\end{align*}

Now $\Be_2$:

\begin{align*}
R \Be_2 R^\dagger
&= 
e^{-e_{12}\phi/2} e^{-e_{23}\theta/2} e^{-e_{12}\psi/2}
\Be_2
e^{e_{12}\psi/2}
e^{e_{23}\theta/2} 
e^{e_{12}\phi/2} \\
&= 
e^{-e_{12}\phi/2} e^{-e_{23}\theta/2} 
(\Be_2 C_\psi - \Be_1 S_\psi)
e^{e_{23}\theta/2} 
e^{e_{12}\phi/2} \\
&= 
(\Be_2 C_\psi C_\theta
- \Be_1 S_\psi)
e^{e_{12}\phi} 
+\Be_3 C_\psi S_\theta \\
&= 
\Be_1 (-C_\psi C_\theta S_\phi - S_\psi C_\phi)
+ \Be_2 (-S_\psi S_\phi + C_\psi C_\theta C_\phi)
+ \Be_3 C_\psi S_\theta \\
\end{align*}

And finally $\Be_3$

\begin{align*}
R \Be_3 R^\dagger
&= 
e^{-e_{12}\phi/2} e^{-e_{23}\theta/2} e^{-e_{12}\psi/2}
\Be_3
e^{e_{12}\psi/2}
e^{e_{23}\theta/2} 
e^{e_{12}\phi/2} \\
&= 
e^{-e_{12}\phi/2} 
\Be_3 e^{e_{23}\theta} 
e^{e_{12}\phi/2} \\
&= 
e^{-e_{12}\phi/2} 
(
\Be_3 C_\theta
-\Be_2 S_\theta
)
e^{e_{12}\phi/2} \\
&= -\Be_2 S_\theta e^{e_{12}\phi} +\Be_3 C_\theta \\
&= 
 \Be_1 S_\theta S_\phi
-\Be_2 S_\theta C_\phi
+\Be_3 C_\theta \\
\end{align*}

This can now be assembled into matrix form
\begin{align*}
\begin{bmatrix}
R(x) \cdot \Be_1 \\
R(x) \cdot \Be_2 \\
R(x) \cdot \Be_3
\end{bmatrix}
=
\begin{bmatrix}
(R \Be_1 R^\dagger) \cdot \Be_1 & (R \Be_2 R^\dagger) \cdot \Be_1 & (R \Be_3 R^\dagger) \cdot \Be_1 \\
(R \Be_1 R^\dagger) \cdot \Be_2 & (R \Be_2 R^\dagger) \cdot \Be_2 & (R \Be_3 R^\dagger) \cdot \Be_2 \\
(R \Be_1 R^\dagger) \cdot \Be_3 & (R \Be_2 R^\dagger) \cdot \Be_3 & (R \Be_3 R^\dagger) \cdot \Be_3 \\
\end{bmatrix}
\begin{bmatrix}
x^1 \\
x^2 \\
x^3 \\
\end{bmatrix} = \BR \Bx
\end{align*}

Therefore we have the composite matrix form for the Euler angle rotations
\begin{align*}
\BR &=
\begin{bmatrix}
C_\psi C_\phi - S_\psi C_\theta S_\phi & -S_\psi C_\phi - C_\psi C_\theta S_\phi & S_\theta S_\phi \\
C_\psi S_\phi + S_\psi C_\theta C_\phi & -S_\psi S_\phi + C_\psi C_\theta C_\phi & -S_\theta C_\phi \\
S_\psi S_\theta                        &                  C_\psi S_\theta        & C_\theta \\
\end{bmatrix}
\end{align*}

Lots of opportunity to make sign errors here.  Let's check with matrix multiplication, which should give the same result

\section{ With composition of rotation matrixes (done wrong, but with discussion and required correction). }

\begin{align}\label{eqn:wrong}
R(x) &= \BR \Bx \\
&= 
\BR_{\psi \Be_3}
\BR_{\theta \Be_1}
\BR_{\phi \Be_3} \Bx
\end{align}

Now, that first rotation is

\begin{align*}
R_\phi(x)
&= e^{-e_{12}\phi/2} (\Be_i x^i) e^{e_{12}\phi/2} \\
&= ( \Be_1 x^1 +\Be_2 x^2) e^{e_{12}\phi} + \Be_3 x^3 \\
&= 
 x^1 ( \Be_1 \cos\phi +\Be_2 \sin\phi )
+x^2 ( \Be_2 \cos\phi -\Be_1 \sin\phi )
+x^3 \Be_3 \\
&= 
 \Be_1 ( x^1 \cos\phi - x^2 \sin\phi )
+\Be_2 ( x^1 \sin\phi + x^2 \cos\phi )
+\Be_3 x^3 \\
\end{align*}

Which has the expected matrix form

\begin{align*}
\BR_{\phi \Be_3} \Bx =
\begin{bmatrix}
\cos\phi & - \sin\phi & 0 \\
\sin\phi & \cos\phi & 0 \\
0 & 0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
x^1 \\
x^2 \\
x^3 \\
\end{bmatrix}
\end{align*}

Using $C_x = \cos(x)$, and $S_x = \sin(x)$ for brievity, the composite rotation is
\begin{align*}
\BR_{\psi \Be_3} \BR_{\theta \Be_1} \BR_{\phi \Be_3} 
&=
\begin{bmatrix}
C_\psi & - S_\psi & 0 \\
S_\psi & C_\psi & 0 \\
0 & 0 & 1 \\
\end{bmatrix} 
\begin{bmatrix}
1 & 0 & 0 \\
0 & C_\theta & - S_\theta \\
0 & S_\theta & C_\theta \\
\end{bmatrix} 
\begin{bmatrix}
C_\phi & - S_\phi & 0 \\
S_\phi & C_\phi & 0 \\
0 & 0 & 1 \\
\end{bmatrix} \\
&=
\begin{bmatrix}
C_\psi & - S_\psi C_\theta & S_\psi S_\theta \\
S_\psi & C_\psi C_\theta & -C_\psi S_\theta \\
0 & S_\theta & C_\theta \\
\end{bmatrix} 
\begin{bmatrix}
C_\phi & - S_\phi & 0 \\
S_\phi & C_\phi & 0 \\
0 & 0 & 1 \\
\end{bmatrix} \\
&=
\begin{bmatrix}
C_\psi C_\phi - S_\psi C_\theta S_\phi & -C_\psi S_\phi - S_\psi C_\theta C_\phi &   S_\psi S_\theta \\
S_\psi C_\phi + C_\psi C_\theta S_\phi & -S_\psi S_\phi + C_\psi C_\theta C_\phi & - C_\psi S_\theta \\
                       S_\theta S_\phi &                         S_\theta C_\phi &          C_\theta \\
\end{bmatrix} \\
\end{align*}

This is different from the rotor generated result above, although with a $\phi$, and $\psi$ interchange things appear to match?

\begin{align*}
\begin{bmatrix}
C_\phi C_\psi - S_\phi C_\theta S_\psi & -S_\phi C_\psi - C_\phi C_\theta S_\psi & S_\theta S_\psi \\
C_\phi S_\psi + S_\phi C_\theta C_\psi & -S_\phi S_\psi + C_\phi C_\theta C_\psi & -S_\theta C_\psi \\
S_\phi S_\theta                        &                  C_\phi S_\theta        & C_\theta \\
\end{bmatrix}
\end{align*}

Where is the mistake?  I suspect it is in the matrix formulation, where the plain old rotations for the axis were multiplied.  Because the rotations need to be along the transformed
axis I bet there is a reversion of matrix products as there was an reversion of rotors?  How would one show if this is the case?

What's needed is more careful treatment of the rotation about the transformed axis.  Considering the first, for a rotation
around the $\Be_1' = (C_\phi, S_\phi, 0)$ axis.  From \cite{PJRotor} we have the rotation matrix for a $\theta$ rotation about
an arbitrary normal $\Bn = (n_1, n_2, n_3)$

\begin{align*}
R_\theta
&=
\begin{bmatrix}
C_\theta(1 -n_1^2) + n_1^2 & n_1 n_2 (1-C_\theta) - n_3 S_\theta & n_1 n_3 (1-C_\theta) + n_2 S_\theta \\
n_1 n_2 (1-C_\theta) + n_3 S_\theta & C_\theta(1 -n_2^2) + n_2^2 & n_2 n_3 (1-C_\theta) - n_1 S_\theta \\
n_1 n_3 (1-C_\theta) - n_2 S_\theta & n_2 n_3 (1-C_\theta) + n_1 S_\theta & C_\theta(1 -n_3^2) + n_3^2 \\
\end{bmatrix} \\
&=
\begin{bmatrix}
C_\theta(1 -{C_\phi}^2) + {C_\phi}^2 & {C_\phi} {S_\phi} (1-C_\theta) & {S_\phi} S_\theta \\
{C_\phi} {S_\phi} (1-C_\theta) & C_\theta(1 -{S_\phi}^2) + {S_\phi}^2 & - {C_\phi} S_\theta \\
- {S_\phi} S_\theta & {C_\phi} S_\theta & C_\theta \\
\end{bmatrix} \\
&=
\begin{bmatrix}
C_\theta({S_\phi}^2) + {C_\phi}^2 & {C_\phi} {S_\phi} (1-C_\theta) & {S_\phi} S_\theta \\
{C_\phi} {S_\phi} (1-C_\theta) & C_\theta({C_\phi}^2) + {S_\phi}^2 & - {C_\phi} S_\theta \\
- {S_\phi} S_\theta & {C_\phi} S_\theta & C_\theta \\
\end{bmatrix} \\
\end{align*}

Now the composite rotation for the sequence of $\phi$, and $\theta$ rotations about the $z$, and $x'$ axis is

\begin{align*}
\BR_{\phi \Be_3, \theta \Be_1'}
&=
\begin{bmatrix}
C_\theta({S_\phi}^2) + {C_\phi}^2 & {C_\phi} {S_\phi} (1-C_\theta) & {S_\phi} S_\theta \\
{C_\phi} {S_\phi} (1-C_\theta) & C_\theta({C_\phi}^2) + {S_\phi}^2 & - {C_\phi} S_\theta \\
- {S_\phi} S_\theta & {C_\phi} S_\theta & C_\theta \\
\end{bmatrix}
\begin{bmatrix}
C_\phi & - S_\phi & 0 \\
S_\phi & C_\phi & 0 \\
0 & 0 & 1 \\
\end{bmatrix} \\
&=
\begin{bmatrix}
C_\phi & -C_\theta S_\phi & {S_\phi} S_\theta \\
S_\phi & C_\theta C_\phi & - {C_\phi} S_\theta \\
0 & S_\theta & C_\theta \\
\end{bmatrix} \\
&=
\begin{bmatrix}
C_\phi & - S_\phi & 0 \\
S_\phi & C_\phi & 0 \\
0 & 0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
1 & 0 & 0 \\
0 & C_\theta & - S_\theta \\
0 & S_\theta & C_\theta \\
\end{bmatrix} \\
&=
\BR_{\phi \Be_3} 
\BR_{\theta \Be_1} \\
\end{align*}

Wow, sure enough the composite rotation matrix is the result of the inverted order product of the two elementary rotation matrixes.  The
algebra here is fairly messy, so it would not be terribly fun to go one step further using just matrixes that the final triple rotation
is not the product of equation \ref{eqn:wrong}, but instead 
requires
the matrix product

\begin{align}\label{eqn:fixed}
R(x) &= \BR \Bx \\
&= 
\BR_{\phi \Be_3} 
\BR_{\theta \Be_1}
\BR_{\psi \Be_3}
\Bx
\end{align}

Assuming that this is true, the swapping of angles to match the rotor expression is fully accounted for, and it is understood how to
correctly do the same calculation in matrix form.

\bibliographystyle{plainnat}
\bibliography{myrefs}

\end{document}
